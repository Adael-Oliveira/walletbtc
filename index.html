<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>BIP-39 / BIP-44 â€” Scanner</title>
  <style>
      body {
        font-family: sans-serif;
        margin: 24px;
        background: #0b0b0b;
        color: #0f0;
      }
      h1 { margin-bottom: 8px; }
      .controls { margin-bottom: 12px; }
      pre {
        overflow: auto;
        background: #151515;
        padding: 12px;
        height: 420px;
        white-space: pre-wrap;
        border-radius: 6px;
      }
      button {
        background: #0f0;
        border: 0;
        padding: 8px 14px;
        color: #000;
        font-weight: bold;
        margin-right: 10px;
        cursor: pointer;
      }
      #status {
        display: inline-block;
        margin-left: 10px;
        font-weight: bold;
        color: #0f0;
      }
      .spinner {
        display: inline-block;
        width: 14px;
        height: 14px;
        border: 2px solid #0f0;
        border-top: 2px solid transparent;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        margin-right: 8px;
        vertical-align: middle;
      }
      @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

      .stats { margin-top: 8px; color: #9f9; font-size: 14px; }
      .addr-ok { color: #6f6; }
      .addr-err { color: #f66; }
  </style>
</head>
<body>
<h1>Busca por Wallets BIP-39 / BIP-44</h1>

<div class="controls">
  <button id="start">COMEÃ‡AR</button>
  <button id="stop" disabled>PARAR</button>
  <span id="status"></span>
  <div class="stats" id="counters">
    Seeds testadas: 0 Â· EndereÃ§os verificados: 0 Â· Wallets com saldo: 0
  </div>
</div>

<pre id="log"></pre>

<!-- libs -->
<script src="https://cdn.jsdelivr.net/npm/axios@1.6.7/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bip39@3.1.0/dist/bip39.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bitcoinjs-lib@6.1.5/dist/bitcoinjs-lib.min.js"></script>

<script>
/* -------- Config -------- */
const OUTFILE = 'wallets_com_saldo.json';
const logElem = document.getElementById('log');
const startBtn = document.getElementById('start');
const stopBtn = document.getElementById('stop');
const statusElem = document.getElementById('status');
const countersElem = document.getElementById('counters');

let ativo = false;
let seedsTestadas = 0;
let enderecosVerificados = 0;
let walletsComSaldo = 0;

function log(txt = '') {
  logElem.textContent += txt + '\\n';
  logElem.scrollTop = logElem.scrollHeight;
}
function updateCounters() {
  countersElem.textContent = `Seeds testadas: ${seedsTestadas} Â· EndereÃ§os verificados: ${enderecosVerificados} Â· Wallets com saldo: ${walletsComSaldo}`;
}
function showSpinner(active) {
  if (active) statusElem.innerHTML = '<span class="spinner"></span>Buscando wallets...';
  else statusElem.innerHTML = '';
}

/* -------- Derivador e info extra -------- */
function derivaEnderecosComPub(mnemonic) {
  const seed = bip39.mnemonicToSeedSync(mnemonic); // Buffer
  const root = bitcoinjs.bip32.fromSeed(seed, bitcoinjs.networks.bitcoin);

  // xpub do nÃ³ neutered (geralmente m ou m/44'/0'/0' conforme uso)
  const xpub = root.neutered().toBase58();

  const addrs = [];
  for (let i = 0; i < 5; i++) {
    const child = root.derivePath(`m/44'/0'/0'/0/${i}`);
    const { address } = bitcoinjs.payments.p2pkh({
      pubkey: child.publicKey,
      network: bitcoinjs.networks.bitcoin
    });
    const pubHex = child.publicKey.toString('hex');
    addrs.push({ index: i, address, pubHex });
  }

  return {
    seedHex: seed.toString('hex'),
    xpub,
    addrs
  };
}

/* -------- Consulta por endereÃ§o (retorna balance por endereÃ§o) -------- */
async function consultaSaldosPorEndereco(addrs) {
  const results = {};
  for (const item of addrs) {
    const addr = item.address;
    try {
      // Blockstream API
      const url = `https://blockstream.info/api/address/${addr}`;
      const res = await axios.get(url);
      const data = res.data;
      const balance = (data.chain_stats.funded_txo_sum - data.chain_stats.spent_txo_sum) / 1e8;
      results[addr] = { balance, success: true };
      enderecosVerificados++;
      updateCounters();
    } catch (e) {
      // registra erro mas continua
      results[addr] = { balance: 0, success: false, error: e.message || String(e) };
      enderecosVerificados++;
      updateCounters();
      log(`âš ï¸ Erro ao consultar ${addr} : ${e.message || e}`);
    }
    // pequena pausa para reduzir chance de rate-limit
    await new Promise(r => setTimeout(r, 150));
  }
  return results;
}

/* -------- Loop principal -------- */
startBtn.onclick = async () => {
  ativo = true;
  startBtn.disabled = true;
  stopBtn.disabled = false;
  showSpinner(true);
  log('=== Iniciando busca ===');

  while (ativo) {
    try {
      const palavras = Math.random() < 0.5 ? 12 : 24;
      const mnemonic = bip39.generateMnemonic(palavras === 12 ? 128 : 256);

      // contadores
      seedsTestadas++;
      updateCounters();

      // derivaÃ§Ã£o + info
      const deriv = derivaEnderecosComPub(mnemonic);

      // log imediato (sempre deve aparecer)
      log(`ðŸ” Seed (${palavras} palavras): ${mnemonic}`);
      log(`Seed HEX (BIP-39 seed): ${deriv.seedHex}`);
      log(`xpub (root neutered): ${deriv.xpub}`);
      log('EndereÃ§os e pubkeys derivados:');
      deriv.addrs.forEach(a => log(`  [${a.index}] ${a.address}  pub: ${a.pubHex}`));

      // consulta saldos por endereÃ§o
      const saldos = await consultaSaldosPorEndereco(deriv.addrs);

      // sumariza e mostra checagem por chave
      let total = 0;
      log('--- VerificaÃ§Ã£o por endereÃ§o ---');
      deriv.addrs.forEach(a => {
        const r = saldos[a.address];
        if (r && r.success) {
          const line = `  â†’ ${a.address}  saldo: ${r.balance} BTC`;
          log(line);
          total += r.balance;
          if (r.balance > 0) {
            log(`    âœ… >>> EndereÃ§o com saldo: ${r.balance} BTC`);
          }
        } else {
          log(`  â†’ ${a.address}  (falha consulta)`);
        }
      });
      log(`Saldo total desta seed: ${total} BTC`);
      log('----------------------------------');

      if (total > 0) {
        walletsComSaldo++;
        updateCounters();
        const registro = {
          mnemonic,
          seedHex: deriv.seedHex,
          xpub: deriv.xpub,
          addrs: deriv.addrs.map(a => a.address),
          saldo: total
        };
        const blob = new Blob([JSON.stringify(registro, null, 2)], { type: 'application/json' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = OUTFILE;
        a.click();
        log('ðŸ’¾ Wallet COM SALDO salva localmente!');
      }

      // espera entre seeds (reduz chance de bloqueio)
      await new Promise(r => setTimeout(r, 600));
    } catch (err) {
      log('â€¼ï¸ Erro no loop principal: ' + (err && err.message ? err.message : String(err)));
      // espera antes de retomar
      await new Promise(r => setTimeout(r, 1000));
    }
  }

  showSpinner(false);
  log('=== Busca finalizada ===');
};

stopBtn.onclick = () => {
  ativo = false;
  startBtn.disabled = false;
  stopBtn.disabled = true;
  showSpinner(false);
  log('=== Parado pelo usuÃ¡rio ===');
};
</script>
</body>
</html>
